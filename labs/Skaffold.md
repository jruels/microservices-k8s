# Using Skaffold to speed up development

In this lab you learn to use Skaffold to optimize development of applications.

## Install skaffold

```bash
brew install skaffold
```



### Create a working directory

```bash
mkdir ~/k3d/skaffold
```



### Enter the directory

```bash 
cd ~/k3d/skaffold
```



## Create the cluster

```bash
k3d cluster create skaffold --api-port 6550 --agents 2
```



## Application configuration

For this tutorial, a Spring-Boot application will be used. It provides one endpoint that returns a simple greeting message in `JSON` format.

In order to run the application, we first need to create a `Dockerfile` file to containerize our application. Here is an example:

```
FROM maven:3-jdk-11 as BUILD
COPY . /usr/src/app
RUN mvn --batch-mode -f /usr/src/app/pom.xml clean package
FROM openjdk:11-jre-slim
ENV PORT 42050
EXPOSE 42050
COPY --from=BUILD /usr/src/app/target /opt/target
WORKDIR /opt/target
CMD ["/bin/bash", "-c", "find -type f -name '*.jar' | xargs java -jar"]
```



In addition to the `Dockerfile`, we will also create a `k8s-app.yaml` file in order to generate the Skaffold configuration file. A simple version of `k8s-app.yaml` file is shown below:

```
apiVersion: v1
kind: Pod
metadata:
  name: skaffold-demo
spec:
  containers:
  - name: skaffold-demo
    image: somerepo/skaffold-demo
```



Now, the Skaffold configuration files can be generated by issuing the command:

```
$ skaffold init
```



This command will generate a `skaffold.yaml` [file containing all needed information](https://skaffold.dev/docs/references/yaml/) in order to build and deploy the application to the desired Kubernetes cluster. The generated `skaffold.yaml` file is:

```yaml
apiVersion: skaffold/v4beta6
kind: Config
metadata:
  name: skaffold
build:
  artifacts:
    - image: somerepo/skaffold-demo
      docker:
        dockerfile: Dockerfile
manifests:
  rawYaml:
    - k8s-app.yaml
```



If prompted to write the configuration, select "Yes"



It is worth mentioning that when creating a new project, you can bootstrap Skaffold configs with `init` command (a very convenient feature). Also, you can [define several configs](https://skaffold.dev/docs/design/config/): one for developing and another to deploy to the stage environment via the run command (the same workflow as with `dev` except for, in this case, Skaffold doesnâ€™t monitor for changes).

## Application deployment flow

After the successful creation of the configuration files, there are two options to deploy the desired application. During development time, we can use the command:

```
$ skaffold dev --default-repo localhost:32000
```



The above command will continuously deploy your application when a file is changed (speeding up development). It monitors the source code files for every change and makes fast re-deployments.

If you want to deploy once and donâ€™t track code changes, you can run the command:

```
$ skaffold run --default-repo localhost:32000
```



We use [insecure MicroK8s repo](https://microk8s.io/docs/registry-built-in) here, but you are free to use your own. If no `--default-repo` is provided by the user, [there is no automated image name rewriting](https://skaffold.dev/docs/environment/image-registries/), and Skaffold will try to push the image as provided in the YAML.

After a successful deployment you can check if your application has been deployed in your Kubernetes cluster using the familiar kubectl commands:

```
$ kubectl get pods
```



You can check that the application is running by using [k9s](https://k9scli.io/) or your Kubernetes dashboard to ensure your application has been deployed as expected.

Skaffold lets you set breakpoints and step through your application in debug purposes. You may find detailed manual about debugging [here](https://skaffold.dev/docs/workflows/debug/).

Finally, you can remove your deployed application with the delete command:

```
$ skaffold delete
```



ðŸŒ– In summary, `skaffold` is a very flexible solution that does not require `helm` and is very extensive on what kind of integrations it can be used with.